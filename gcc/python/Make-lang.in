#This file is part of GCC.

#GCC is free software; you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation; either version 3, or (at your option)
#any later version.

#GCC is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#along with GCC; see the file COPYING3.  If not see
#<http://www.gnu.org/licenses/>.

PYTHON_EXES = python

.phony: python

GCCPY_INSTALL_NAME := $(shell echo gccpy|sed '$(program_transform_name)')
GCCPY_TARGET_INSTALL_NAME := $(target_noncanonical)-$(shell echo gccpy|sed '$(program_transform_name)')

python: gccpy$(exeext) gpy1$(exeext)

py-lang.o: $(srcdir)/python/py-lang.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \
  $(FLAGS_H) toplev.h $(GGC_H) $(TREE_H) $(DIAGNOSTIC_H) input.h options.h opts.h \
  gt-python-py-lang.h gtype-python.h
	$(CC) $(ALL_COMPILERFLAGS) $(ALL_CPPFLAGS) $(INCLUDES) \
	$(LDFLAGS) -c -o $@ $(srcdir)/python/py-lang.c

GCCPY_C_OBJS = py-lang.o $(BACKEND) $(LIBSDEPS) attribs.o
gpy1$(exeext): $(GCCPY_C_OBJS)
	$(CC) $(ALL_CFLAGS) $(LDFLAGS) -o $@ $(GCCPY_C_OBJS) \
	$(GMPLIBS) $(LIBS) $(BACKENDLIBS) 

pyspec.o: $(srcdir)/python/pyspec.c $(CONFIG_H) $(SYSTEM_H) \
  coretypes.h $(DIAGNOSTIC_H) $(TREE_H) $(FLAGS_H) toplev.h langhooks.h $(TM_H)
	$(CC) $(ALL_COMPILERFLAGS) $(ALL_CPPFLAGS) $(DRIVER_DEFINES) \
		$(INCLUDES) $(LDFLAGS) -c -o $@ $(srcdir)/python/pyspec.c

GCCPY_D_OBJS = $(GCC_OBJS) pyspec.o version.o prefix.o intl.o
gccpy$(exeext): $(GCCPY_D_OBJS) $(EXTRA_GCC_OBJS) $(LIBDEPS)
	$(LINKER) $(ALL_LINKERFLAGS) $(LDFLAGS) -o $@ \
	  $(GCCPY_D_OBJS) $(EXTRA_GCC_OBJS) $(LIBS)

python.srcextra: 
python.all.cross:

python.start.encap:
python.rest.encap:
python.man:
python.srcman:

python.mostlyclean:
	cd $(srcdir)/python; rm -f *.o

python.clean: python.mostlyclean

python.tags: force
	cd $(srcdir)/python; etags -o TAGS.sub *.y *.l *.c *.h; \
	etags --include TAGS.sub --include ../TAGS.sub

python.info: 
python.srcinfo: 
python.dvi: 
python.pdf: 
doc/python.info: 
doc/python.dvi: 
doc/python.pdf: 
python.html: 

.phony:python.install.common
.phony:python.install

python.install python.install.common python.install-common: python.install.common.done

python.install.common.done:  installdirs 
	for name in $(PYTHON_EXES); \
	do \
	   if [ -f $$name ] ; then \
	    name2="`echo \`basename $$name\` | sed -e '$(program_transform_name)' `"; \
	    rm -f $(DESTDIR)$(bindir)/$$name2$(exeext); \
	    echo $(INSTALL_PROGRAM) $$name$(exeext) $(DESTDIR)$(bindir)/$$name2$(exeext); \
	    $(INSTALL_PROGRAM) $$name$(exeext) $(DESTDIR)$(bindir)/$$name2$(exeext); \
	    chmod a+x $(DESTDIR)$(bindir)/$$name2$(exeext); \
	  fi ; \
	done

python.install-info: 
python.install-pdf: 
python.install-man:

# Stage hooks:
# The main makefile has already created stage?/python.

python.stage1: stage1-start
	-mv python/*$(objext) stage1/python
python.stage2: stage2-start
	-mv python/*$(objext) stage2/python
python.stage3: stage3-start
	-mv python/*$(objext) stage3/python
python.stage4: stage4-start
	-mv python/*$(objext) stage4/python
python.stageprofile: stageprofile-start
	-mv python/*$(objext) stageprofile/python
python.stagefeedback: stagefeedback-start
	-mv python/*$(objext) stagefeedback/python

config.status: python/config-lang.in
